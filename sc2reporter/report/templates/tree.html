<!-- {% extends "layout.html" %}

{% block body %} -->
<html>
<head>
<script src="https://cdn.jsdelivr.net/npm/d3-dispatch@3"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-quadtree@3"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-timer@3"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-force@3"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="{{url_for('static', filename='d3.phylogram.js')}}"></script>
<script src="{{url_for('static', filename='newick.js')}}"></script>
<style>
/* HTML styles */
/* html{ width: 100%; } */
body{ 
  width: 100%; 
  margin: 0; padding: 0; 
  display: flex; 
  font-family: sans-serif; font-size: 75%; }

/* SVG styles */
svg {
  flex-basis: 100%;
  /* width: 100%; */
  min-width: 200px;
}
.links line {
  stroke: #aaa;
}
.nodes circle {
  pointer-events: all;
}

</style>
</head>
<body>
<svg></svg>

<script>
tree = '{{ tree}}'

tree = (Newick.parse(tree))

edgesAndNodes = {"nodes":[], "edges": []}
undiscoveredBranchsets = []

depth = 0

function insertNode(name){
  edgesAndNodes['nodes'].push({'Name':name})
}
function insertEdge(source, target, length){
  edgesAndNodes['edges'].push({"source":source, "target":target, "length":length})
}

function parseBranchSet(branchset, depth){
  branchsets = []

  if (branchset['name'] === ''){
    insertNode(depth)
  }
  
  for (leaf in branchset['branchset']){
    insertEdge(source = depth, target = branchset['branchset'][leaf]['name'], length =branchset['branchset'][leaf]['length'] )
    if (branchset['branchset'][leaf]['name'] != ''){
      insertNode(branchset['branchset'][leaf]['name'])
    }else{
      branchsets.push(branchset['branchset'][leaf])
    }
  }
  return branchsets
}
while (true) {
  parseBranchSet(tree, depth)
  depth = depth +1
  break
}
console.log(edgesAndNodes)
</script>

</body>
</html>

<!-- {% endblock %} -->